{% extends "base.html" %}
{% block title %}Add Alert{% endblock %}
{% block content %}
<div class="page-title">â• Add New Alert</div>
<div style="max-width:480px;">
<div class="card">
<div class="card-body">
    {% if error %}<div class="alert alert-error">âŒ {{ error }}</div>{% endif %}
    <form method="POST" id="addForm">
        <div class="form-group">
            <label>Stock Symbol</label>
            <input type="text" name="symbol" id="symbolInput" placeholder="e.g. AAPL, TSLA, CBA.AX"
                   style="text-transform:uppercase;" required>
            <div class="input-hint">
                ğŸ‡ºğŸ‡¸ US stocks: Enter ticker only (e.g. AAPL, TSLA)<br>
                ğŸ‡¦ğŸ‡º Australian stocks: Add .AX suffix (e.g. CBA.AX, BHP.AX, WBC.AX)
            </div>
        </div>
        <div id="pricePreview" style="display:none;background:#e8f4f8;padding:10px 14px;border-radius:8px;margin-bottom:16px;font-size:14px;">
            <strong id="priceSymbol"></strong> current price: <strong id="priceValue"></strong>
        </div>
        <div class="form-group">
            <label>Target Price ($)</label>
            <input type="number" name="target" step="0.01" min="0.01" placeholder="0.00" required>
        </div>
        <div class="form-group">
            <label>Alert When Price Goes</label>
            <select name="alert_type">
                <option value="above">ğŸ”¼ Above target</option>
                <option value="below">ğŸ”½ Below target</option>
            </select>
        </div>
        <div style="display:flex;gap:10px;margin-top:20px;">
            <a href="/dashboard" class="btn btn-outline" style="flex:1;justify-content:center;">â† Cancel</a>
            <button type="submit" class="btn btn-primary" style="flex:2;">âœ… Create Alert</button>
        </div>
    </form>
</div>
</div>
</div>
{% endblock %}
{% block scripts %}
<script>
let priceTimer;
document.getElementById('symbolInput').addEventListener('input', function() {
    clearTimeout(priceTimer);
    const sym = this.value.toUpperCase().trim();
    if (sym.length >= 1) {
        priceTimer = setTimeout(() => {
            fetch('/price/' + sym)
                .then(r => r.json())
                .then(data => {
                    if (data.price) {
                        document.getElementById('priceSymbol').textContent = sym;
                        document.getElementById('priceValue').textContent = '$' + data.price.toFixed(2);
                        document.getElementById('pricePreview').style.display = 'block';
                    } else {
                        document.getElementById('pricePreview').style.display = 'none';
                    }
                });
        }, 800);
    }
});
</script>
{% endblock %}
